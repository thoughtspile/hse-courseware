# Занятие 25.11.16

* Поговорили про классы в js (через `class`)
* Достали данные из API OpenStreetMap.

## Overpass API

OpenStreetMap (https://www.openstreetmap.org/) —
вики с кучей геоданных. API - интерфейс, с которым удобно работать программам,
а не людям. У OSM есть два API:

* OSM API — редактировать статьи, доставать информацию о пользователях и все такое. *Не то, что нужно.*
* Overpass API — доставать геоданные. Запросы можно делать в Overpass XML (не советую) и на Overpass QL.

Запросы удобно тестировать на https://overpass-turbo.eu/. Интерфейс подставляет
координаты области, видимой на карте, вместо `{{bbox}}`.

### Структура данных OSM

Объекты трех типов:
* `node` — точка с координатой (например, дерево),
* `way` — последовательность точек (например, улица),
* `relation` — набор из `node` и `way`, возможно с ролями. Например, relation
автобусный маршрут может состоять из улиц, остановок, светофоров, депо.

У каждого объекта могут быть теги — пары ключ-значение. Например, у node может
быть тег `amenity=bar`, то есть эта точка — бар.

### Запрос

Базовый запрос состоит из:

* типа элементов: `node`, `relation`, `area`;
* фильтра по области `(south,west,north,east)`: `node(50.6,7.0,50.8,7.3);`
* фильтра по тегам `node[<key>=<value>];`

Например, `node[amenity=bar](41.8690495032235,12.4818420410156,41.910134104298,12.5222682952880);`
ищет все бары в центре Рима. Фильтры собираются вместе: `node[amenity=bar][phone];` ищет
все бары c указанным телефоном.

## Получение данных

`out;` выводит данные из запроса (по умолчанию запрос ничего не возвращает).
Обычно его ставят в конце программы. `[out:json];` меняет формат вывода со
стандартного XML на JSON.
```
[out:json];
node[amenity=bar](41.8690495032235,12.4818420410156,41.910134104298,12.5222682952880);
out;
```

## Объединение

Данные нескольких запросов можно объединить скобками:
```
(
  node[railway=subway_entrance];
  node[railway=tram_stop];
);
```
ищет все входы в метро и трамвайные остановки.

## Рекурсия

way и relation не содержат самих точек с координатами.
Рекурсия вниз — `>`, достает из way точки, из relation -- точки и way.
Например, хотим получить все трамвайные маршруты: `relation[route=tram];`.
Получим все node и way оператором рекурсии: `relation[route=tram];>;`.
При этом сами relation потерялись. Используем объединение с текущим рабочим множеством, `._`:
```
relation[route=tram];
(._; >;); // это объединение
```

### Документация

* Популярные теги: http://wiki.openstreetmap.org/wiki/Category:Key_descriptions
* http://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide
* http://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL#Print_.28out.29
